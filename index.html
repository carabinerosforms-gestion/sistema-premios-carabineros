<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Postulaci√≥n a Premios - Carabineros de Chile</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="data/sistema-data.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/utils.js" defer></script>
    <script src="js/main.js" defer></script>
    <script src="js/formulario.js" defer></script>
    <script src="js/google-sheets.js" defer></script>
</head>
<body>
    <div class="container">
        <!-- HEADER CON COLORES OFICIALES -->
        <header>
            <div class="logo-institucional">
                <div class="escudo-container">
                    <div class="escudo">C</div>
                </div>
                <div class="titulo-principal">
                    <h1>SISTEMA DE POSTULACI√ìN A PREMIOS</h1>
                    <div class="subtitulo">Carabineros de Chile - Orden General N¬∞ 3125/2024</div>
                </div>
            </div>
            
            <!-- BARRA DE PROGRESO MEJORADA -->
            <div class="progress-bar">
                <div class="step" id="step1">
                    <span class="step-number">1</span> Categor√≠a
                </div>
                <div class="step" id="step2">
                    <span class="step-number">2</span> Datos
                </div>
                <div class="step" id="step3">
                    <span class="step-number">3</span> Antecedentes
                </div>
                <div class="step" id="step4">
                    <span class="step-number">4</span> Evaluaci√≥n
                </div>
                <div class="step" id="step5">
                    <span class="step-number">5</span> Revisi√≥n
                </div>
            </div>
        </header>
        
        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <!-- ALERTA GLOBAL -->
            <div class="alert" id="globalAlert"></div>
            
            <!-- PASO 1: SELECCI√ìN DE CATEGOR√çA -->
            <div class="step-content active" id="stepContent1">
                <div class="form-section">
                    <h3>Selecci√≥n de Categor√≠a de Premio</h3>
                    <p>Seleccione la categor√≠a para la cual postula el funcionario, conforme al Manual OG 3125:</p>
                    
                    <div class="form-group">
                        <label>Categor√≠a de Premio <span class="required">*</span></label>
                        <select id="categoriaPremio" class="form-control">
                            <option value="">-- Seleccione categor√≠a --</option>
                            <option value="d1">d.1 - Desempe√±o Profesional Operativo</option>
                            <option value="d2">d.2 - Servicios Destacados a la Comunidad</option>
                            <option value="d3">d.3 - Acci√≥n Policial Destacada</option>
                            <option value="d4">d.4 - Acciones Destacadas en DD.HH.</option>
                            <option value="f1">f.1 - Desempe√±o Profesional Administrativo</option>
                        </select>
                        <div class="error-message" id="categoriaError">Debe seleccionar una categor√≠a de premio</div>
                        <div class="form-help">Consulte el Manual OG 3125 para verificar requisitos espec√≠ficos</div>
                    </div>
                    
                    <!-- REQUISITOS ESPEC√çFICOS DE LA CATEGOR√çA -->
                    <div id="requisitosCategoria" class="requisitos-box hidden">
                        <h4>Requisitos espec√≠ficos de la categor√≠a seleccionada:</h4>
                        <ul id="listaRequisitos"></ul>
                    </div>
                </div>
                
                <!-- BOTONES DE NAVEGACI√ìN -->
                <div class="btn-group">
                    <button class="btn btn-secondary" disabled onclick="Formulario.prevStep(0)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-primary" onclick="Formulario.nextStep(2)" id="btnNextStep1">
                        Siguiente ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- PASO 2: DATOS PERSONALES -->
            <div class="step-content" id="stepContent2">
                <div class="form-section">
                    <h3>Datos del Funcionario</h3>
                    <div class="form-grid">
                        <!-- RUN -->
                        <div class="form-group">
                            <label>RUN <span class="required">*</span></label>
                            <input type="text" id="run" class="form-control" placeholder="12.345.678-9" 
                                   oninput="Utils.formatearRUNCampo(this)" onblur="Utils.validarRUNCampo()">
                            <div class="error-message" id="runError">RUN inv√°lido. Formato: 12.345.678-9</div>
                        </div>
                        
                        <!-- NOMBRES -->
                        <div class="form-group">
                            <label>Nombres <span class="required">*</span></label>
                            <input type="text" id="nombres" class="form-control" placeholder="JUAN CARLOS" 
                                   oninput="this.value = this.value.toUpperCase()">
                            <div class="error-message" id="nombresError">Debe ingresar los nombres</div>
                        </div>
                        
                        <!-- APELLIDOS -->
                        <div class="form-group">
                            <label>Apellidos <span class="required">*</span></label>
                            <input type="text" id="apellidos" class="form-control" placeholder="P√âREZ GONZ√ÅLEZ" 
                                   oninput="this.value = this.value.toUpperCase()">
                            <div class="error-message" id="apellidosError">Debe ingresar los apellidos</div>
                        </div>
                        
                        <!-- NOMBRAMIENTO -->
                        <div class="form-group">
                            <label>Nombramiento <span class="required">*</span></label>
                            <select id="nombramiento" class="form-control">
                                <option value="">-- Seleccione --</option>
                                <option value="PNS">P.N.S. (Personal de Nombramiento Supremo)</option>
                                <option value="PNI">P.N.I. (Personal de Nombramiento Institucional)</option>
                                <option value="CPR">C.P.R. (Contratado por Resoluci√≥n)</option>
                            </select>
                            <div class="error-message" id="nombramientoError">Seleccione el tipo de nombramiento</div>
                        </div>
                        
                        <!-- GRADO -->
                        <div class="form-group">
                            <label>Grado <span class="required">*</span></label>
                            <select id="grado" class="form-control" disabled>
                                <option value="">-- Seleccione nombramiento primero --</option>
                            </select>
                            <div class="error-message" id="gradoError">Seleccione el grado correspondiente</div>
                        </div>
                        
                        <!-- ALTA REPARTICI√ìN -->
                        <div class="form-group">
                            <label>Alta Repartici√≥n <span class="required">*</span></label>
                            <input type="text" id="altaReparticion" class="form-control" 
                                   placeholder="Ej: Zona Metropolitana">
                            <div class="error-message" id="altaRepError">Debe ingresar la Alta Repartici√≥n</div>
                        </div>
                        
                        <!-- REPARTICI√ìN -->
                        <div class="form-group">
                            <label>Repartici√≥n <span class="required">*</span></label>
                            <input type="text" id="reparticion" class="form-control" 
                                   placeholder="Ej: Prefectura Norte">
                            <div class="error-message" id="reparticionError">Debe ingresar la Repartici√≥n</div>
                        </div>
                        
                        <!-- DOTACI√ìN -->
                        <div class="form-group">
                            <label>Dotaci√≥n <span class="required">*</span></label>
                            <input type="text" id="dotacion" class="form-control" 
                                   placeholder="Ej: 6¬™ Comisar√≠a 'Recoleta'">
                            <div class="error-message" id="dotacionError">Debe ingresar la Dotaci√≥n</div>
                        </div>
                    </div>
                </div>
                
                <!-- BOTONES DE NAVEGACI√ìN -->
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="Formulario.prevStep(1)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-primary" onclick="Formulario.nextStep(3)" id="btnNextStep2">
                        Siguiente ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- PASO 3: ANTECEDENTES ADMINISTRATIVOS -->
            <div class="step-content" id="stepContent3">
                <div class="form-section">
                    <h3>Antecedentes Administrativos y Disciplinarios</h3>
                    <p>Complete la informaci√≥n seg√∫n los registros institucionales (Art√≠culo 8.7 OG 3125)</p>
                    
                    <div class="form-grid">
                        <!-- LISTA DE M√âRITOS -->
                        <div class="form-group">
                            <label>¬øEn Lista N¬∞1 de M√©ritos o N¬∞2 Satisfactorios? <span class="required">*</span></label>
                            <select id="listaMeritos" class="form-control">
                                <option value="">-- Seleccione --</option>
                                <option value="lista1">Lista N¬∞1 - M√©ritos</option>
                                <option value="lista2">Lista N¬∞2 - Satisfactorios</option>
                                <option value="ninguna">No est√° en ninguna lista</option>
                            </select>
                            <div class="error-message" id="listaError">Selecci√≥n requerida seg√∫n OG 3125</div>
                        </div>
                        
                        <!-- SANCIONES √öLTIMOS 12 MESES -->
                        <div class="form-group">
                            <label>¬øTiene sanciones (d√≠as de arresto) √∫ltimos 12 meses? <span class="required">*</span></label>
                            <select id="sanciones12meses" class="form-control" onchange="Formulario.validarElegibilidad()">
                                <option value="">-- Seleccione --</option>
                                <option value="no">No</option>
                                <option value="si">S√≠</option>
                            </select>
                            <div class="error-message" id="sancionesError">Selecci√≥n requerida</div>
                        </div>
                        
                        <!-- PROCESO JUDICIAL -->
                        <div class="form-group">
                            <label>¬øSometido a proceso judicial? <span class="required">*</span></label>
                            <select id="procesoJudicial" class="form-control" onchange="Formulario.validarElegibilidad()">
                                <option value="">-- Seleccione --</option>
                                <option value="no">No</option>
                                <option value="si_imputado">S√≠ - Formalizado/Imputado</option>
                                <option value="si_victima">S√≠ - En calidad de v√≠ctima/testigo</option>
                            </select>
                            <div class="error-message" id="procesoError">Selecci√≥n requerida</div>
                        </div>
                    </div>
                    
                    <!-- HISTORIAL DISCIPLINARIO -->
                    <h4 style="margin: 30px 0 15px 0; color: var(--azul-carabineros); padding-bottom: 10px; border-bottom: 1px solid #eee;">
                        Historial Disciplinario (trayectoria)
                    </h4>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Amonestaciones</label>
                            <input type="number" id="amonestaciones" class="form-control" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Reprensiones</label>
                            <input type="number" id="reprensiones" class="form-control" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Arrestos</label>
                            <input type="number" id="arrestos" class="form-control" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label>D√≠as licencia acto del servicio</label>
                            <input type="number" id="licenciaActo" class="form-control" min="0" value="0">
                        </div>
                    </div>
                </div>
                
                <!-- BOTONES DE NAVEGACI√ìN -->
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="Formulario.prevStep(2)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-primary" onclick="Formulario.nextStep(4)" id="btnNextStep3">
                        Siguiente ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- PASO 4: EVALUACI√ìN -->
            <div class="step-content" id="stepContent4">
                <div class="form-section">
                    <h3>Evaluaci√≥n de Factores - <span id="categoriaTitulo"></span></h3>
                    <p>Califique cada factor seg√∫n la escala establecida en el Manual OG 3125:</p>
                    
                    <div class="requisitos-box">
                        <h4>Escala de evaluaci√≥n:</h4>
                        <ul>
                            <li><strong>3 - Excelente:</strong> Desempe√±o √≥ptimo, exento de faltas importantes</li>
                            <li><strong>2 - Muy Bueno:</strong> Desempe√±o por sobre lo esperado</li>
                            <li><strong>1 - Bueno:</strong> Desempe√±o con aportes esperados</li>
                        </ul>
                        <p style="margin-top: 10px; color: var(--rojo-carabineros); font-weight: bold;">
                            * Puntaje 3 requiere justificaci√≥n obligatoria
                        </p>
                    </div>
                    
                    <!-- FACTORES DIN√ÅMICOS -->
                    <div id="factoresEvaluacion"></div>
                    
                    <!-- SECCI√ìN ESPECIAL PARA ACCI√ìN POLICIAL -->
                    <div id="seccionAccionPolicial" class="hidden">
                        <div class="form-group">
                            <label>Narraci√≥n del hecho destacado <span class="required">*</span></label>
                            <textarea id="narracionHecho" class="form-control" rows="4" 
                                      placeholder="Describa brevemente la acci√≥n policial destacada, indicando fecha, lugar, circunstancias y participantes..."></textarea>
                            <div class="error-message" id="narracionError">Debe describir la acci√≥n policial destacada</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Razones que fundamentan la proposici√≥n <span class="required">*</span></label>
                            <textarea id="razonesFundamentacion" class="form-control" rows="4" 
                                      placeholder="Explique las razones para proponer esta acci√≥n, considerando impacto, riesgo asumido, resultados obtenidos..."></textarea>
                            <div class="error-message" id="razonesError">Debe proporcionar las razones de fundamentaci√≥n</div>
                        </div>
                    </div>
                    
                    <!-- TOTAL PUNTAJE -->
                    <div class="form-group" style="margin-top: 30px;">
                        <label>Total Puntaje Obtenido:</label>
                        <input type="text" id="totalPuntaje" class="form-control" style="font-size: 1.2rem; font-weight: bold; text-align: center;" 
                               readonly value="0">
                        <div class="form-help">Suma de todos los factores evaluados</div>
                    </div>
                </div>
                
                <!-- BOTONES DE NAVEGACI√ìN -->
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="Formulario.prevStep(3)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-primary" onclick="Formulario.nextStep(5)" id="btnNextStep4">
                        Siguiente ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- PASO 5: REVISI√ìN FINAL -->
            <div class="step-content" id="stepContent5">
                <div class="form-section">
                    <h3>Revisi√≥n Final de la Postulaci√≥n</h3>
                    
                    <!-- ALERTA DE VALIDACI√ìN -->
                    <div class="alert" id="revisionAlert"></div>
                    
                    <!-- RESUMEN DE POSTULACI√ìN -->
                    <div id="resumenPostulacion"></div>
                    
                    <!-- VALIDACI√ìN OG 3125 -->
                    <div class="requisitos-box">
                        <h4>Validaci√≥n conforme a Orden General N¬∞ 3125</h4>
                        <ul id="validacionLista">
                            <li id="valCategoria">‚úì Categor√≠a seleccionada correctamente</li>
                            <li id="valDatos">‚úì Datos personales completos y v√°lidos</li>
                            <li id="valAntecedentes">‚úì Antecedentes validados seg√∫n Art. 8.7</li>
                            <li id="valEvaluacion">‚úì Evaluaci√≥n completa con justificaciones</li>
                            <li id="valElegibilidad">‚úì Cumple requisitos de elegibilidad</li>
                            <li id="valSheets">‚è≥ Conexi√≥n con Google Sheets</li>
                        </ul>
                    </div>
                    
                    <!-- FIRMA DEL PROPONENTE -->
                    <div style="margin-top: 30px; padding: 20px; border: 2px dashed #ddd; border-radius: 8px;">
                        <h4 style="color: var(--azul-carabineros); margin-bottom: 15px;">Declaraci√≥n del Proponente</h4>
                        <p style="margin-bottom: 15px; color: var(--gris-oscuro);">
                            <input type="checkbox" id="declaracionVeracidad" style="margin-right: 10px;">
                            <label for="declaracionVeracidad" style="font-weight: 600;">
                                Declaro bajo juramento que la informaci√≥n proporcionada en esta postulaci√≥n es veraz, 
                                completa y ajustada a los requisitos establecidos en la Orden General N¬∞ 3125 de Carabineros de Chile.
                            </label>
                        </p>
                        <div class="error-message" id="declaracionError" style="margin-top: 10px;">
                            Debe aceptar la declaraci√≥n de veracidad
                        </div>
                    </div>
                </div>
                
                <!-- BOTONES FINALES -->
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="Formulario.prevStep(4)">
                        ‚Üê Anterior
                    </button>
                    <button class="btn btn-success" onclick="GoogleSheets.enviarPostulacion()" id="btnEnviar" disabled>
                        ‚úÖ Enviar Postulaci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL DE CONFIRMACI√ìN -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úÖ Postulaci√≥n Enviada Exitosamente</h3>
                <button class="close-modal" onclick="Utils.closeModal()">√ó</button>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-size: 4rem; color: var(--verde-ok); margin-bottom: 10px;">‚úì</div>
                <h4 style="color: var(--azul-carabineros); margin-bottom: 15px;">Postulaci√≥n Registrada</h4>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p><strong>ID de Postulaci√≥n:</strong> <span id="postulacionId" style="font-weight: bold; color: var(--azul-carabineros);"></span></p>
                <p><strong>Fecha y Hora:</strong> <span id="postulacionFecha"></span></p>
                <p><strong>Estado:</strong> <span class="status-badge status-complete">COMPLETA CONFORME OG 3125</span></p>
                <p><strong>Google Sheets:</strong> <span id="sheetsStatus" class="status-badge status-complete">REGISTRADO</span></p>
            </div>
            
            <p style="margin-bottom: 20px; color: var(--gris-oscuro);" id="mensajeConfirmacion">
                La postulaci√≥n ha sido registrada en el sistema y se encuentra disponible para revisi√≥n 
                por la autoridad competente seg√∫n el proceso establecido en la Orden General N¬∞ 3125.
            </p>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="Main.nuevaPostulacion()">
                    üìù Nueva Postulaci√≥n
                </button>
                <button class="btn btn-secondary" onclick="Utils.closeModal()">
                    Cerrar
                </button>
            </div>
        </div>
    </div>
    
    <!-- BOTONES ADICIONALES -->
    <div style="text-align: center; margin-top: 20px; padding: 15px; background: var(--gris-claro); border-radius: 8px;">
        <button class="btn btn-warning" onclick="GoogleSheets.testConexionSheets()" style="margin: 5px;">
            üîÑ Probar Conexi√≥n
        </button>
        <div style="margin-top: 10px; font-size: 0.8rem; color: var(--gris-medio);">
            Sistema v1.0 | Desarollado por Carabineros de Chile
        </div>
    </div>
</body>
</html>
